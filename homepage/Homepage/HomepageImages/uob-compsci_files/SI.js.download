var C4A=C4A||{},C4A=function(){var p=null,l=[],c=[];this.iOSFix=!0,this.ClearSessionData=function(){D.Data={}},this.SessionData=function(){return JSON.stringify(D.Data)},this.PersistData=function(){return JSON.stringify(r.Data)};var D=new function(){var a="_C4AS",t=function(){try{var t=window.location.hostname,e=window.location.href;return t=t.toUpperCase(),-1==(e=e.toUpperCase()).indexOf(t)?"Unknown Domain":t.toLowerCase()}catch(t){return"Unknown Domain"}}(),e=function(){try{return encodeURIComponent(document.location.href.split("?")[0])}catch(t){return"Unknown Url"}}();this.Data={Active:!0,IsActiveTracking:!0,IsActiveProspect:!0,SCook:!1,PCook:!1,Access:"",SID:null,HSGUID:null,PageEntryURL:"",PageURL:"",SiteHitUTC:"",PageHitUTC:"",HBINT:0,HBTO:0,DebugIP:"",DebugShowUI:!1,IsPros:!1,IsProsMatchedMethod:0,HostName:t,ReqTool:!0,Tools:[],ProTools:[]},this.Data.HostName=t,this.Data.PageEntryURL=e,this.GetToolByScriptOrExperience=function(t,e){for(var i in this.Data.Tools){var o=this.Data.Tools[i];if(0<t){if(o.ScriptID==t)return o}else if(null!=e&&o.ExpGuid==e)return o}},this.TestCookie=function(){return navigator.cookieEnabled},this.Read=function(){if(window.sessionStorage){var t=sessionStorage.getItem("SISession");S.Log("Session:Read:"+t),null!=t&&(this.Data=JSON.parse(t))}else for(var e=a+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var n=i[o];" "==n.charAt(0);)n=n.substring(1,n.length);0==n.indexOf(e)&&(this.Data=JSON.parse(n.substring(e.length,n.length)))}return null},this.Write=function(){var t=m.Stringify(this.Data);if(!window.sessionStorage)return document.cookie=a+"="+t+";path=/;SameSite=None; Secure;",!0;sessionStorage.setItem("SISession",t),S.Log("Session:Write:"+t)},this.URL=function(){this.Data.PageURL=encodeURIComponent(document.location.href);var t=JSON.parse(JSON.stringify(this.Data));delete t.ProTools;t="SessionData="+m.Stringify(t);return(t=(t=(t=(t=(t=(t=t+"&PName="+C.GetPageName())+"&Vis="+r.GetVisits())+"&LastVisUTC="+r.GetLastVisitUTC())+"&Refer="+encodeURIComponent(document.referrer))+"&PID="+r.Data.PID)+"&UnqVID="+C.UniqueVisitorID).length<1800&&(t=t+"&TPushD="+C.GetCustomData()),2e3<t.length&&(S.Log("Session:URL - 2000 Characters exceeded, can process page hit"),this.SendToServer("/LogToDbaseFromClient","Message=Session:URL - 2000 Characters exceeded, can process page hit&sourceLogCode=JS03")),t}},r=new function(){var a="_C4AP";this.Data={PID:"",MatchedMethod:0,LastVIUTC:"",Activity:[]},this.TestCookie=function(){return!!C4A.Track.UseCookie&&navigator.cookieEnabled},this.Read=function(){var t=window.localStorage||(window.globalStorage?globalStorage[location.hostname]:null);if(t){t=t.SIPersist;t&&(S.Log("Persist:Read:"+t),this.Data=JSON.parse(t))}else for(var e=a+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var n=i[o];" "==n.charAt(0);)n=n.substring(1,n.length);0==n.indexOf(e)&&(this.Data=JSON.parse(n.substring(e.length,n.length)))}return null},this.Write=function(){if(!C4A.Track.UseCookie)return!1;var t=m.Stringify(this.Data),e=window.localStorage||(window.globalStorage?globalStorage[location.hostname]:null);return e?(e.SIPersist=t,S.Log("Persist:Write:"+t)):document.cookie=a+"="+t+";SameSite=None; Secure; expires=Tue, 31 Dec 2030 00:00:00 UTC",!0},this.GetVisits=function(){for(var t=0,e=0;e<this.Data.Activity.length;e++)"VI"==this.Data.Activity[e].Type&&t++;return t},this.GetLastVisitUTC=function(){for(var t=this.Data.Activity.length-1;0<=t;t--)if("VI"==this.Data.Activity[t].Type)return this.Data.Activity[t].UTC;return null},this.AddActivity=function(t,e,i,o,n,a){S.Log("Persist.AddActivity()"),""!=t&&(this.Data.PID=t),""!=e&&(this.Data.LastVIUTC=e);a={UTC:i,Type:o,GUID:n,Other:a};10<=this.Data.Activity.length&&this.Data.Activity.shift(),r.Data.Activity.push(a),this.Write()},this.UpdatePID=function(t,e){null!=t&&(this.Data.PID=t),null!=e&&(this.Data.MatchedMethod=e),this.Write()}},C=new function(){"use strict";var t=/<[^>]*>/g,e=null;this.Enabled=!0,this.UseCookie=!0,this.PageName=document.title.replace(t,"").replace("&","%26"),this.AllowProactives=!0,this.UniqueVisitorID=null,this.GetPageName=function(){return this.PageName=("string"==typeof this.PageName?this.PageName:document.title).replace(t,"").replace("&","%26")},this.AddCustomData=function(t){e=t},this.GetCustomData=function(){return e}},n=new function(){"use strict";var o=null,n=null,a=null,e=null;this.Origin=null,this.UniqueVisitorID=null,this.AddOrder=function(t,e,i){o=t,n=e,a=i},this.AddCustomData=function(t){e=t},this.URL=function(){var t="";return t+="&PCook="+D.Data.PCook,t+="&SID="+D.Data.SID,t+="&DebugIP="+D.Data.DebugIP,t+="&PID="+r.Data.PID,t+="&PName="+C.GetPageName(),t+="&PUrl="+document.location.href,t+="&Vis="+r.GetVisits(),t+="&COrigin="+this.Origin,t+="&CUnqVID="+this.UniqueVisitorID,t+="&CCustomD="+e,t+="&COrdRef="+o,t+="&COrdVal="+n,t+="&COrdCur="+a}},s=new function(){"use strict";var e=null;this.UniqueVisitorID=null,this.AddCustomData=function(t){e=t},this.GetCustomData=function(){return e},this.URL=function(){return"&PCook="+D.Data.PCook+"&SID="+D.Data.SID+"&DebugIP="+D.Data.DebugIP+"&PID="+r.Data.PID+"&PName="+C.GetPageName()+"&PUrl="+document.location.href+"&Vis="+r.GetVisits()+"&PUnqVID="+this.UniqueVisitorID+"&PCustomD="+e}},m=new function(){this.UIGetWindowHeightWidth=function(){var t=window,e=document,i=e.documentElement,o=e.getElementsByTagName("body")[0],e=t.innerWidth||i.clientWidth||o.clientWidth,i=t.innerHeight||i.clientHeight||o.clientHeight,o=new Array;return o.Height=i,o.Width=e,o},this.UIGetScrollPosition=function(){var t,e,i,o=new Array;return null!=window.pageYOffset?(o.TopOffset=pageYOffset,o.LeftOffset=pageXOffset):(t=(e=document).documentElement,i=e.body,e=t.scrollLeft||i.scrollLeft||0,i=t.scrollTop||i.scrollTop||0,o.TopOffset=i,o.LeftOffset=e),o},this.UIShowWarning=function(t){var e=document.createElement("div");e.id="C4A_divWarning",e.setAttribute("style","background-color:red; border:2px solid white; height:160px; width:200px; padding:8px; position:fixed; bottom:0; right:0; color:white; font-family:Arial; font-size:12px;"),e.innerHTML="<strong style='margin-bottom:12px; display:block; font-size:14px;'>Warning</strong>"+t;var i=document.createElement("div");i.setAttribute("style","width:100%; background-color:white; height:1px; margin-bottom:4px;margin-top:12px;");t=document.createElement("div");t.innerHTML='Contact <a href="http://click4assistance.co.uk" target="_blank" title="Contact Click4Assistance" style="color:white;">Click4Assistance</a> support for help and advice.',e.appendChild(i),e.appendChild(t),document.body.appendChild(e)},this.SetOpacity=function(t,e){var i=void 0!==t.style.opacity,o=!i&&void 0!==t.style.filter;i&&(t.style.opacity=parseFloat(e/100)),o&&(t.style.filter="alpha(opacity="+e+")"),t.style.MozOpacity=parseFloat(e/100)},this.Stringify=function(t){var e=typeof t;if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var i,o,n=[],a=t&&t.constructor==Array;for(i in t)"string"==(e=typeof(o=t[i]))?o='"'+o+'"':"object"==e&&null!==o&&(o=JSON.stringify(o)),n.push((a?"":'"'+i+'":')+String(o));return(a?"[":"{")+String(n)+(a?"]":"}")},this.CreateGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},this.IsDeviceCompatibleForTools=function(){try{var t=navigator.userAgent;if(null==t)return!1;var e=t.toLowerCase();if(0<e.indexOf("android")){for(var i,o,n=t.length,a=e.indexOf("android")+"android".length+1;a<n;++a){var r=t.chatCodeAt(a);if(!(48<=charcode&&charcode<=57||46==charcode)){i=a;break}}for(var s=0,a=i+1;a<n;++a)if(46==(r=t.chatCodeAt(a)))++s;else if(!(48<=r&&r<=57)){++o;break}var l=t.substr(i,o-i);return 2==s&&(e=l.lastIndexOf("."),l=l.substr(0,e)),!(parseInt(l)<5)||(S.Log("Android version is less than 5.0"),-1<l.indexOf("4.0")?(S.Log("Android version is 4.0"),!1):-1<l.indexOf("4.1")?(S.Log("Android version is 4.1"),!1):-1<l.indexOf("4.2")?(S.Log("Android version is 4.2"),!1):(S.Log("Android version is greater than 4.2"),!0))}return!0}catch(t){return!0}},this.IsDeviceCompatibleForTools2=function(){try{var t=navigator.userAgent;if(null==t)return!1;if(0<t.toLowerCase().indexOf("android")){var e,o,n=t.toLowerCase().indexOf("android");for(i=n+8;i<t.length;i++)if(48<=(a=t.charCodeAt(i))||a<=57||46==a){e=i;break}var a,r=0;for(i=e+1;i<t.length;i++)if(46==(a=t.charCodeAt(i))&&r++,!(48<=a&&a<=57||46==a)){o=i;break}var s=t.substr(e,o-e);return 2==r&&(n=s.lastIndexOf("."),s=s.substr(0,n)),!(parseInt(s)<5)||(S.Log("Android version is less than 5"),-1<s.indexOf("4.0")?(S.Log("Android version is 4.0"),!1):-1<s.indexOf("4.1")?(S.Log("Android version is 4.1"),!1):-1<s.indexOf("4.2")?(S.Log("Android version is 4.2"),!1):(S.Log("Android version is greater than 4.2"),!0))}}catch(t){return!0}},this.IsDeviceiPhone=function(){try{var t=navigator.userAgent;if(null==t)return!1;if(0<t.toLowerCase().indexOf("iphone"))return S.Log("Device is iPhone"),!0}catch(t){return!1}},this.IsUrlXSS=function(t){try{return 0<t.toLowerCase().indexOf("<script")?(S.Log("IsUrlXSS: "+t),!0):(0<t.toLowerCase().indexOf("<//script>")||0<t.toLowerCase().indexOf("%3c;script")||0<t.toLowerCase().indexOf("script%3e")||0<t.toLowerCase().indexOf("&lt;script")||0<t.toLowerCase().indexOf("javascript%3a"))&&(S.Log("IsUrlXSS: "+t),!0)}catch(t){return!1}},this.IsGuid=function(t){try{return null==t||""==t?!1:/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/.test(t)}catch(t){return!0}}},v=new function(){"use strict";var i=null,e=null,a=!1,o=null;this.DomainSI="https://v4in1-si.click4assistance.co.uk",this.DomainTI="https://v4in1-ti.click4assistance.co.uk",this.SendToServer=function(t,e){var i,o,n="C4A_ScriptSend";a||(null!=p&&""!=p?m.IsGuid(p)?(i=this.DomainSI+t+"?AccGUID="+p+"&"+e+"&"+Math.random(),S.Log("Comms.SendToServer() => "+i),t=(o=window.document).getElementsByTagName("head").item(0),(e=o.getElementById(n))&&t.removeChild(e),(o=o.createElement("script")).src=encodeURI(i),o.type="text/javascript",o.defer=!0,o.id=n,t.appendChild(o)):console.warn("SendToServer(): _accountGuid is an invalid guid"):console.warn("SendToServer(): _accountGuid is empty"))},this.StartHeartBeat=function(){var t;D||D.Data?0!=D.Data.Active&&(!isNaN(D.Data.HBINT)&&0!=D.Data.HBINT||(D.Data.HBINT=5),(isNaN(D.Data.HBTO)||0==D.Data.HBTO||10<=D.Data.HBTO)&&(D.Data.HBTO=5),i=(new Date).setMinutes((new Date).getMinutes()+D.Data.HBTO),t=1e3*D.Data.HBINT,S.Log("Comms.StartHeartBeat() => delay: "+t+"ms"),null!=e&&(clearInterval(e),S.Log("Comms.StartHeartBeat() - Heartbeat Timer cleared")),e=window.setInterval(v.SendHeartBeat,t)):S.Log("Comms.StartHeartBeat() - No Session or No Session.Data")},this.CreateProactiveSession=function(t,e){o=t,v.SendToServer("/CreateProactiveSession",e)},this.StopHeartBeat=function(){clearInterval(e),i=e=null,S.Log("Comms.StopHeartBeat()")},this.SendHeartBeat=function(){if(null!=i)if(new Date>i)v.StopHeartBeat();else if(a)v.StopHeartBeat();else{if(!D&&!D.Data)return S.Log("Comms.SendHeartBeat() - No Session or No Session.Data"),void v.StopHeartBeat();var t,e=document.location.href;m.IsUrlXSS(e)?v.StopHeartBeat():(e=e.split("?")[0],e=encodeURIComponent(e),t="&Active="+D.Data.Active,t+="&Access="+D.Data.Access,t+="&SID="+D.Data.SID,t+="&DebugIP="+D.Data.DebugIP,t+="&PUrl="+e,v.SendToServer("/HeartBeat",t))}else v.StopHeartBeat()},this.GetPageName=function(t){switch(t){case 1:case 2:return"DefaultChat.aspx";case 3:return"DefaultSmartContact.aspx";case 4:return"DefaultClick2Call.aspx";case 5:return"DefaultMeetingRoom.aspx";case 6:return"DefaultPromotion.aspx";default:S.Log("Comms.GetPageName() => [INVALID TOOLTYPE] ToolType:"+t)}},this.CB_Initilize=function(){var e,t;D.Data.DebugShowUI&&C4A.Debug.DisplayPanel(),S.Log("Comms.CB_Initilize()"),S.Log("Comms.CB_Initilize() => There are "+(l?l.length:"0")+" (fixed tools) in the collection"),l&&l.forEach(function(t,e){S.Log("Comms.CB_Initilize() => Tool: "+(e+1)+" Rendering Button & Widget - ScriptId: "+t.ScriptID),t.Button.Render(),t.Widget.Render();var i=D.GetToolByScriptOrExperience(t.ScriptID,t.ExpGuid);i?(S.Log("Comms.CB_Initilize() => Tool: "+(e+1)+" - Displayed: "+i.Displayed),i.Displayed&&t.Widget.Open()):S.Log("Comms.CB_Initilize() => Unable to find tool using ScriptID: "+t.ScriptID+" OR ExpGuid:"+t.ExpGuid)}),S.Log("Comms.CB_Initilize() => There are "+(D.Data.ProTools?D.Data.ProTools.length:"ZERO")+" (proactive tools) in the collection"),D.Data.ProTools&&(e=!0,D.Data.ProTools.forEach(function(t){t.Dis&&-1<[1,2,4].indexOf(t.TT)&&(e=!1,S.Log("Comms.CB_Initilize() => The ProTool is set to be displayed - EGuid: "+t.EGuid),I.Issue(t,t.Rules[0]))}),e&&D.Data.ProTools.forEach(function(t){t.Dis&&(S.Log("Comms.CB_Initilize() => The ProTool is set to be displayed - EGuid: "+proTool.EGuid),I.Issue(t,t.Rules[0]))})),!0===D.Data.PCook&&r.Read(),!0===C.Enabled&&!0===D.Data.IsActiveTracking?(t=!1,null!==s.UniqueVisitorID&&!0===D.Data.Active&&"T"===D.Data.Access.substr(1,1)&&(S.Log("Comms.CB_Initilize() => Sending prospect data"),this.SendToServer("/AddProspect",s.URL()),t=!0),null!==s.UniqueVisitorID&&"F"===D.Data.Access.substr(1,1)&&(m.UIShowWarning("Prospect feature is disabled – You must remove the prospect script to prevent this warning appearing."),this.SendToServer("/LogToDbaseFromClient","Message=A prospect was attempted to be added, but prospects are disabled&sourceLogCode=JS02")),null!=n.Origin&&"F"==D.Data.Access.substr(2,1)?(m.UIShowWarning("Conversion are Disabled – you must remove the conversion script to prevent this warning appearing."),C4A.Comms.SendToServer("/LogToDbaseFromClient","Message=A conversion was attempted to be added, but conversions are disabled&sourceLogCode=JS01")):null!==n.Origin&&!0===D.Data.Active&&"T"===D.Data.Access.substr(2,1)&&(t?setTimeout(function(){S.Log("Comms.CB_Initilize() => Sending conversion data (with 1000ms delay)"),C4A.Comms.SendToServer("/AddConversion",n.URL())},1e3):(S.Log("Comms.CB_Initilize() => Sending conversion data"),C4A.Comms.SendToServer("/AddConversion",n.URL()))),D.Write(),v.StartHeartBeat(),I.Initilize()):S.Log("Comms.CB_Initilize() => Tracking not enabled - Prospects, Conversions, Heartbeat & Proactives not processed")},this.CB_DDosAttack=function(){S.Log("Comms.CB_DDosAttack()"),a=!0},this.CB_SessionWrite=function(t){var e,i,o;S.Log("Comms.CB_SessionWrite() => "+t),D||D.Data?(e=D.Data.PageURL,i=D.Data.SiteHitUTC,o=D.Data.PageHitUTC,D.Data=JSON.parse(t),D.Data.PageURL=e,D.Data.SiteHitUTC=i,D.Data.PageHitUTC=o,""===D.Data.SiteHitUTC&&(D.Data.SiteHitUTC=Math.floor((new Date).getTime()/1e3)),""===D.Data.PageHitUTC&&(D.Data.PageHitUTC=Math.floor((new Date).getTime()/1e3)),o=encodeURIComponent(document.location.href),D.Data.PageURL!==o&&(D.Data.PageURL=o,D.Data.PageHitUTC=Math.floor((new Date).getTime()/1e3)),D.Write(),D.Read()):S.Log("Comms.CB_SessionWrite() - No Session or No Session.Data")},this.CB_AddActivity=function(t,e,i,o,n,a){S.Log("Comms.CB_AddActivity() => "+t+" - "+e+" - "+i+" - "+o+" - "+n+" - "+a),r.AddActivity(t,e,i,o,n,a),r.Write(),r.Read()},this.CB_UpdatePID=function(t,e){S.Log("Comms.CB_UpdatePID() => pid: "+t+" - matchedMethod: "+e),D.Data.IsPros=!0,D.Data.IsProsMatchedMethod=e,D.Write(),D.Read(),r.UpdatePID(t,e),r.Write(),r.Read()},this.CB_RequestPersistentCookie=function(){var t;S.Log("Comms.CB_RequestPersistentCookie()"),!1!==D.Data.IsActiveTracking&&null!==D.Data.SID&&"null"!==D.Data.SID&&(r.Read(),t="SID="+D.Data.SID+"&PersistData="+m.Stringify(r.Data),v.SendToServer("/AcceptPersistentData/",t))},this.CB_UIShowWarning=function(t){S.Log("Comms.CB_UIShowWarning() => "+t),m.UIShowWarning(t)},this.CB_AnimatePreDialogWindow=function(t,e,i,o){var n,a=document.getElementById("iFraC4AW"+o);a?(n=null,l&&l.forEach(function(t){t.ScriptID==o&&(n=t.Widget?t.Widget.Animation():null)}),n?(n.Initilize(a,t,e,i,!1),n.ScriptId=o,S.Log("Comms.CB_AnimatePreDialogWindow() => Animate(4)"),n.Animate(4)):S.Log("Comms.CB_AnimatePreDialogWindow() => Tool / Animation not found for script id: "+o)):S.Log("Comms.CB_AnimatePreDialogWindow() => iFraC4AW iframe not found for script id:"+o)},this.CB_ResizeWindow=function(e,i,o,n){var a=document.getElementById("iFraC4AW"+o);a?D.Data.Tools&&D.Data.Tools.forEach(function(t){t.ScriptID!=o||t.Width==e&&t.Height==i||(a.style.width=e+"px",a.style.height=i+"px",(t=D.GetToolByScriptOrExperience(o,n)).Width=e,t.Height=i,D.Write())}):S.Log("Comms.CB_ResizeWindow() iFraC4AW iframe not found for script id:"+o)},this.CB_ResizeWindowWithAnimation=function(s,l,c,d){var u=document.getElementById("iFraC4AW"+c);u?D.Data.Tools&&D.Data.Tools.forEach(function(t){var e,i,o,n,a,r;t.ScriptID===c&&(e=parseFloat(u.style.width,10)+s+"px",i=parseFloat(u.style.height,10)+l+"px",o=0,n=s/20,a=l/20,r=null,r=setInterval(function(){if(20<=o){u.style.width=e,u.style.height=i;var t=D.GetToolByScriptOrExperience(c,d);return t.Width=u.style.width,t.Height=u.style.height,D.Write(),void clearInterval(r)}0!=n&&(u.style.width=u.offsetWidth+n+"px"),0!=a&&(u.style.height=u.offsetHeight+a+"px"),++o},25))}):S.Log("Comms.CB_ResizeWindowWithAnimation() iFraC4AW iframe not found for script id:"+c)},this.CB_ReceivePostMessage=function(t){S.Log("Comms.CB_ReceivePostMessage() => event.data: "+t.data);var e=t.origin||t.originalEvent.origin;if(e==C4A.Comms.DomainTI){if(3<=t.data.length&&"!_{"!=t.data.substring(0,3))if(S.Log("Comms.CB_ReceivePostMessage() => About to evaluate"),-1!=t.data.indexOf("window.location.href")){var i=t.data.replace("window.location.href=","").replace(/("|')/g,"");S.Log("Comms.CB_ReceivePostMessage() => window.location.href = "+i),window.location.href=i}else{var t=t.data.replace("C4A.Comms.","").replace(/, /g,",").replace(");","").split("("),o=t[0],n=t[1].split(",");switch(o){case"CB_ChatClear":C4A.Comms.CB_ChatClear(n[0].replace(/'/g,""));break;case"CB_ChatCreated":C4A.Comms.CB_ChatCreated(n[0].replace(/'/g,""),n[1].replace(/'/g,""),n[2].replace(/'/g,""),n[3].replace(/'/g,""),n[4].replace(/'/g,""),n[5].replace(/'/g,""));break;case"CB_CloseProactive":C4A.Comms.CB_CloseProactive();break;case"CB_CloseWidget":C4A.Comms.CB_CloseWidget(Number(n[0]));break;case"CB_MinimiseWidget":C4A.Comms.CB_MinimiseWidget(Number(n[0]));break;case"CB_ResetTools":C4A.Comms.CB_ResetTools();break;case"CB_ResizeWindow":C4A.Comms.CB_ResizeWindow(Number(n[0]),Number(n[1]),Number(n[2]),n[3].replace(/'/g,""));break;case"CB_ResizeWindowWithAnimation":C4A.Comms.CB_ResizeWindowWithAnimation(Number(n[0]),Number(n[1]),Number(n[2]),n[3].replace(/'/g,""));break;case"CB_StopProactiveTimer":C4A.Comms.CB_StopProactiveTimer();break;default:S.Log('Comms.CB_ReceivePostMessage() => Invalid function: "'+o+'"')}}}else S.Log("Comms.CB_ReceivePostMessage() => [ERROR] Invalid Origin: ("+e+") - C4A.Comms.DomainTI: ("+C4A.Comms.DomainTI+")")},this.CB_ProactiveSessionCreated=function(t){"function"==typeof o&&o(t),o=null},this.CB_IssueProactive=function(t,e){var i;!1!==m.IsDeviceCompatibleForTools()&&(S.Log("Comms.CB_IssueProactive() => toolIdx: "+t+", ruleIdx: "+e),null!==(i=D.Data.ProTools)&&I.Issue(i[t],i[t].Rules[e]),D.Write())},this.CB_DontIssueProactive=function(t,e){S.Log("Comms.CB_DontIssueProactive() => toolIdx: "+t+", ruleIdx: "+e);var i=D.Data.ProTools;null!==i&&(i[t].Rules[e].S="VOID"),D.Write()},this.CB_CloseProactive=function(){S.Log("Comms.CB_CloseProactive()");var i=999,o=!1,t=D.Data.ProTools;t&&(t.forEach(function(t,e){t.Dis=!1,0==t.Rules[0].RT&&(o=!0,i=e)}),999!==i&&(t.splice(i,1),S.Log("Comms.CB_CloseProactive() => Manual proactive removed from array"))),!1===o&&S.Log("Comms.CB_CloseProactive() => [Error]: Unable to find tool/proactive"),I.CloseProactive(),D.Write()},this.CB_ChatCreated=function(e,i,o,n,a,t){S.Log("Comms.CB_ChatCreated() => experienceGuid: "+e+" - instanceGuid: "+i+" - chatGuid: "+o+" - chatAccountGuid: "+n+" - chatExperienceGuid: "+a+" - chatStartDTS: "+t),this.CB_AddActivity("","",t,"CH",o,"");var r=D.Data.IsActiveProactive=!1;D.Data.Tools?D.Data.Tools.forEach(function(t){t.ExpGuid.toUpperCase()==e.toUpperCase()&&(r=!0,t.ChatGuid=o.toUpperCase(),t.ChatAccountGuid=n.toUpperCase(),t.ChatExperienceGuid=a.toUpperCase())}):S.Log("Comms.CB_ChatCreated() => There are no Tools"),D.Data.ProTools?D.Data.ProTools.forEach(function(t){t.EGuid.toUpperCase()===e.toUpperCase()&&(r=!0,t.ChatGuid=o.toUpperCase(),t.ChatAccountGuid=n.toUpperCase(),t.ChatExperienceGuid=a.toUpperCase(),t.InstanceGuid=i.toUpperCase(),t.Dis=!0)}):S.Log("Comms.CB_ChatCreated() => There are no ProTools"),!1===r?S.Log("Comms.CB_ChatCreated() => [Error]: Unable to find Tool/Proactive"):S.Log("Comms.CB_ChatCreated() => Tool/Proactive found and updated with chatGuid"),D.Write()},this.CB_ChatClear=function(i){S.Log("Comms.CB_ChatClear() => experienceGuid: "+i);var o=-1,n=(D.Data.Tools,!1);D.Data.Tools&&(D.Data.Tools.forEach(function(t,e){t.ExpGuid.toUpperCase()==i.toUpperCase()&&(n=!0,t.ChatAccountGuid=null,t.ChatExperienceGuid=null,t.ChatGuid=null,t.Displayed=!1,9999==t.ScriptID&&(o=e))}),-1!=o&&D.Data.Tools.splice(o,1)),o=-1,l&&(l.forEach(function(t,e){9999==t.ScriptID&&(o=e)}),-1!=o&&l.splice(o,1)),D.Data.ProTools&&(D.Data.ProTools.forEach(function(t,e){t.EGuid.toUpperCase()==i.toUpperCase()&&0==t.Rules[0].RT&&(o=e,n=!0)}),-1!==o&&D.Data.ProTools.splice(o,1)),S.Log("Comms.CB_ChatClear() =>  found: "+n),D.Write()},this.CB_ResetTools=function(){S.Log("Comms.CB_ResetTools()"),l&&l.forEach(function(t){t.Widget.Close(!1)}),D.Data.Tools&&D.Data.Tools.forEach(function(t){t.Displayed=!1,t.ChatGuid=null,t.ChatAccountGuid=null}),D.Data.ProTools&&D.Data.ProTools.forEach(function(t){t.Dis=!1,t.ChatGuid&&(t.ChatGuid=null),t.ChatAccountGuid&&(t.ChatAccountGuid=null),t.ChatExperienceGuid&&(t.ChatExperienceGuid=null),t.InstanceGuid&&(t.InstanceGuid=null)}),I.CloseProactive(),D.Write()},this.CB_OpenWidget=function(e){S.Log("Comms.CB_OpenWidget() => scriptId: "+e),l&&0!=e&&l.forEach(function(t){t.ScriptID==e&&t.Widget.Open(void 0,!0)})},this.CB_CloseWidget=function(t){S.Log("Comms.CB_CloseWidget() => scriptId: "+t),l&&0!=t&&l.forEach(function(t){t.Widget.Close(!1)}),D.Write()},this.CB_MinimiseWidget=function(e){S.Log("Comms.CB_MinimiseWidget() => scriptId: "+e),l&&0!=e&&l.forEach(function(t){t.ScriptID==e&&t.Widget.Close(!0)}),D.Write()},this.CB_HotspotHit=function(t){S.Log("Comms.CB_HotspotHit() => hotspotGuid: "+t),D.Data.HSGUID=t.toUpperCase(),D.Write()},this.CB_AddProactiveTool=function(t){D.Data.ProTools.push(t),I.Initilize()},this.CB_DisplayManualProactive=function(t,e,i,o,n,a,r,s,l,c,d){var u=[],d={RT:0,RM:"",RDS:1,RS:d};u.push(d);i={PGUID:t,EGuid:e,Dis:!1,TT:o,IT:4,H:a,W:r,GO:s,AId:l,ET:0,EM:0,EDW:c,SPGUID:i,Rules:u};D.Data.ProTools.push(i);u=D.Data.ProTools.length-1;1==i.TT||2==i.TT||4==i.TT?(u="ExpGuid="+i.EGuid+"&ToolIdx="+u+"&RuleIdx=0",S.Log("Proactive.CheckRules() => IsExperienceAvailable - Sending data: "+u),v.SendToServer("/IsExperienceAvailable",u)):I.Issue(i,i.Rules[0])},this.CB_StopProactiveTimer=function(){I.StopProactiveTimer()}},I=new function(){var r,n=[],a=[],s=null,l=null,c=null,d=null,u=null,h=!0;function f(){var t=D.Data.ProTools;if(null!=t)for(var e in t)for(var i in t[e].Rules)"PROCESS"==t[e].Rules[i].S&&(t[e].Rules[i].S="VOID")}this.AddUrlData=function(t){c=t},this.AddCustomData=function(t){d=t},this.AddCustomDataGuid=function(t){u=t},this.AddPage=function(t,e){var i=isNaN(t)||null==t,o=e.length<4||null==e;i||o||(n.push(t),a.push(e))},this.CloseProactive=function(){l&&(l.Close(),l=null)},this.Initilize=function(){var t,e,i,o;S.Log("Proactive.Initilize()"),C.AllowProactives?m.IsDeviceCompatibleForTools()?D.Data.IsActiveProactive?"T"==D.Data.Access.substr(3,1)?(e=(t=D.Data.ProTools).length,null!=t&&0!=e?(i=0,o=m.UIGetWindowHeightWidth().Width,t.forEach(function(t){0!=t.EDW&&t.EDW>o&&++i}),i!=e?(S.Log("Proactive.Initilize()There are proactives that need to be checked..."),null!=s&&(clearInterval(s),s=null),s=setInterval(function(){0==I.CheckRules()&&(clearInterval(s),s=null)},5e3)):S.Log("Proactive.Initilize()All rules exceptions are below the screen width of:"+o+" - No need to check rules")):S.Log("Proactive.Initilize() No Proactives - No need to check rules")):S.Log("Proactive.Initilize() Proactives not allowed - No need to check rules"):S.Log("Proactive.Initilize() Proactives are not active, possibly a previous chat has occurred - No need to check rules"):S.Log("Proactive.Initilize() IsDeviceCompatibleForTools returned false - No need to check rules"):S.Log("Proactive.Initilize() Track.AllowProactives returned false - No need to check rules")},this.CheckRules=function(){S.Log("Proactive.CheckRules()");var t=D.Data.ProTools;if(null!=t){var e,i,o,n=Math.floor((new Date).getTime()/1e3),a=window.location.host.toUpperCase().replace("WWW.",""),r=window.location.href.toUpperCase(),s=D.Data.Tools,l=null;for(o in null!=D.Data.HSGUID&&(l=D.Data.HSGUID.toString().toUpperCase()),s)null!=(d=s[o]).ChatGuid&&(S.Log("Proactive.CheckRules() Visitor is in embedded chat - VOID all rules"),f()),d.Displayed&&(S.Log("Proactive.CheckRules() Visitor has a tool displayed - VOID all rules"),f());if(D.Data.IsActiveProactive||(S.Log("Proactive.CheckRules() Proactives are not active, possibly a previous chat has occurred - VOID all rules"),f()),!function(){var t,e=D.Data.ProTools;if(null==e)return!1;for(t in e){var i,o=e[t];for(i in o.Rules){var n=o.Rules[i];if(S.Log("Proactive.AreThereRulesToProcess - rule.S()"+n.S),"PROCESS"==n.S)return!0}}return!1}())return S.Log("Proactive.CheckRules() - There are no rules to process - return false and stop timer"),!1;for(o in S.Log("Proactive.CheckRules()Globals:=====NOW:"+n+", Session.Data.SiteHitUTC:"+D.Data.SiteHitUTC+", Session.Data.PageHitUTC:"+D.Data.PageHitUTC+", window.location.host:"+a+", Session.Data.HSGUID:"+l),t){var c,d=t[o];for(c in S.Log("Proactive.CheckRules()ProTools[i]:=====TT :"+d.TT+", NextCheckUTC :"+d.NextCheckUTC),d.Rules){var u=d.Rules[c];if("VOID"!=u.S&&"ISSUED"!=u.S)if(i=u.RM.toUpperCase(),S.Log("Proactive.CheckRules()Rules:=====RT:"+u.RT+", RM:"+i+", RDS:"+u.RDS),n<=d.NextCheckUTC)S.Log("Proactive.CheckRules()NextCheckUTC is AFTER NOW, no need to check this rule");else{var h=1==u.RT&&i==a,p=2==u.RT&&i==r,C=3==u.RT&&-1<r.indexOf(i),g=4==u.RT&&i==l,m="";if(h?m="DOMAIN":p?m="EXACT":C?m="CONTAINS":g&&(m="HOTSPOT"),h||p||C||g){if(S.Log("Proactive.CheckRules() - MATCH ON "+m),(e=D.Data.SiteHitUTC+u.RDS)<n){if(1!=d.TT&&2!=d.TT&&4!=d.TT)return I.Issue(d,u),!0;u="ExpGuid="+d.EGuid+"&ToolIdx="+o+"&RuleIdx="+c;S.Log("Proactive.CheckRules()IsExperienceAvailable - Sending data:"+u),v.SendToServer("/IsExperienceAvailable",u);continue}S.Log("Proactive.CheckRules() - MATCH ON "+m+"  - NOW:"+n+" - ISSUEON:"+e+" - DIFF:"+(e-n))}S.Log("Proactive.CheckRules() NO MATCH ...")}}}}},this.BuildiFrame=function(t,e){var i=document.getElementById("iFraC4AWPro");i||((i=document.createElement("iframe")).id="iFraC4AWPro",i.title="Click4Assistance Live Chat",i.style.display="none",i.allow="camera; microphone",i.setAttribute("AlignRight","true"),i.style.marginheight="0px",i.style.marginWidth="0px",i.style.borderWidth="0px",i.allowtransparency=!0,document.body.insertBefore(i,null),S.Log("Proactive.BuildiFrame()iFrame Created - proTool.W:"+t.W+" - proTool.H:"+t.H)),i.style.cssText="border:0; z-index:2147483601; width:"+t.W+"px; height:"+t.H+"px;",i.style.height=t.H+"px",i.style.width=t.W+"px",i.style.display="none";var o="",o=v.DomainTI+"/"+v.GetPageName(t.TT)+"?AccGUID="+p+"&ExpGUID="+t.EGuid+"&ToolType="+t.TT+"&ChatGUID="+t.ChatGuid+"&ChatAccountGUID="+t.ChatAccountGuid+"&ImpType="+t.IT+"&ProactiveGUID="+t.PGUID+"&SessionProGUID="+t.SPGUID+"&SID="+D.Data.SID+"&RSound="+e;null!=c&&(o+="&"+c),null!=d&&(o+="&PushD="+d),null!=u&&(o+="&CustomDataGuid="+u);try{var n=null==p?null:p.toUpperCase();null==p||"01DCDED4-D168-4D22-AB4B-D073501B8353"!=n&&"05E4E0A8-61D3-41CC-8454-3B2425F643C8"!=n&&"3A7ADAFD-9926-4503-BB98-E3BB2B04DC7B"!=n||(n=document.location.href,m.IsUrlXSS(n)?o+="&OpenedFromFullPageUrl=XSS":o+="&OpenedFromFullPageUrl="+encodeURIComponent(n))}catch(t){S.Log("Proactive.BuildiFrame() - OpenedFromFullPageUrl _iFra:"+i.id+" - url:"+o)}return i.src=o,S.Log("Proactive.BuildiFrame()iFrame src:"+i.src),i},this.StopProactiveTimer=function(){h=!1,null!=s&&(clearInterval(s),s=null)},this.Issue=function(e,i){switch(S.Log("Proactive.Issue()"),e.Issued=1,e.Dis=!0,e.NextCheckUTC=Math.floor((new Date).getTime()/1e3)+60*e.EM,i.S="ISSUED",1==e.ESAR&&f(),D.Write(),i.RT){case 1:S.Log("Proactive.Issue()### ISSUE:Domain Match ###");break;case 2:S.Log("Proactive.Issue()### ISSUE:Exact Match ###");break;case 3:S.Log("Proactive.Issue()### ISSUE:Contains Match ###");break;case 4:S.Log("Proactive.Issue()### ISSUE:Hotspot Match ###")}var t,o,n,a=0==e.Rules[0].RT;e.Dis=!1,D.Write(),2==e.IT||4==e.IT||5==e.IT?(e.SPGUID,t=e.EGuid,o=e.TT,n=a,a=function(t){h?(e.SPGUID=t,D.Write(),(r=I.BuildiFrame(e,i.RS)).onload=function(){null==l&&(l=new C4A.Animation),l.Initilize(r,e.H,e.W,0,e.GO),l.Animate(e.AId),r.onload=null}):S.Log("Proactive.Issue.DisplayIssuedProactive()ERROR - _allowIssueOfProactives == false , abort showing proactive")},n="SessionGUID="+D.Data.SID+"&ExperienceGUID="+t+"&ToolType="+o+"&IsManualPush="+n,S.Log("Proactive.SetIssuedOn()Sending data:"+n),v.CreateProactiveSession(a,n)):S.Log("Proactive.Issue()ERROR - Invalid Implementation Type for Proactive (can only be a 2,4,5)")}},S=new function(){"use strict";function l(t){var e,i;null!=t&&(i=e="",1<=(t=t.split("()")).length&&(e=t[0]),2<=t.length&&(i=t[1]),"Comms.SendToServer"==e&&0<i.indexOf("HeartBeat")||(t=document.getElementById("debugDiv"))&&(t.innerHTML+="<div style='color: grey;'>"+e+"</div><div style='margin-left: 20px;'>"+i+"</div>"))}this.Data=[],this.DisplayPanel=function(){var t=document.createElement("div");t.setAttribute("style",'background-color: #f5f5f5; border: 1px solid #ccc; box-sizing: border-box; font-family: "Consolas"; width: 100%;');var e=document.createElement("div");e.setAttribute("style","background-color: #ccc; box-sizing: border-box; color: #000; font-size: 16px; font-weight: 700; padding: 8px;"),e.innerHTML="Debugging";var i=document.createElement("button");i.innerHTML="Session",i.onclick=function(){var t=document.getElementById("lblSession");t&&(t.innerText=C4A.SessionData())};var o=document.createElement("div");o.id="lblSession";var n=document.createElement("button");n.innerHTML="Persist",n.onclick=function(){var t=document.getElementById("lblPersist");t&&(t.innerText=C4A.PersistData())};var a=document.createElement("div");a.id="lblPersist";var r=document.createElement("div");r.id="debugDiv",r.setAttribute("style","border-top: 1px solid #ccc; box-sizing: border-box; font-size: 14px; overflow-wrap: anywhere; padding: 16px;"),t.appendChild(e),t.appendChild(i),t.appendChild(o),t.appendChild(n),t.appendChild(a),t.appendChild(r),document.body.appendChild(t);for(var s=0;s<this.Data.length;s++)l(this.Data[s])},this.Log=function(t){null!=t&&(500<this.Data.length&&(this.Data=[]),this.Data.push(t),document.getElementById("debugDiv")&&l(t))}};return{Run:function(t){!function(t){try{if(S.Log("Run()"),null!=document.referrer&&-1<document.referrer.toUpperCase().indexOf(v.DomainTI.toUpperCase())&&(S.Log("Run() - Referred by the ToolInterface - Clearing Session"),window.sessionStorage.clear()),S.Log("Run() - sessionStorage:"+(window.sessionStorage?"True":"False")),-1<location.href.toUpperCase().indexOf("C4ADONTTRACK=Y"))return;if(p=t,D.Read(),!D.Data.Active)return S.Log("Run - Account not enabled"),m.UIShowWarning("Your Account is not enabled");""==D.Data.SCook&&(D.Data.SCook=!!D.TestCookie()),""==D.Data.PCook&&(D.Data.PCook=!!r.TestCookie()),window.addEventListener?addEventListener("message",C4A.Comms.CB_ReceivePostMessage,!1):attachEvent("onmessage",C4A.Comms.CB_ReceivePostMessage);var e,i=!1;for(tCount=0;tCount<l.length;tCount++){for(var o in D.Data.Tools)D.Data.Tools[o].ScriptID==l[tCount].ScriptID&&(i=!0);i||(e={ScriptID:l[tCount].ScriptID,ToolType:0,ImpType:0,Height:0,Width:0,Displayed:!1,ChatGuid:null,ChatAccountGuid:null,ExpGuid:null},D.Data.Tools.push(e),D.Data.ReqTool=!0,D.Write())}if(l.length!=D.Data.Tools.length&&S.Log("Run()ERROR - Tools array does not match Tools collection"),S.Log("Run()Tools loaded"),null==D.Data.SID&&1==D.Data.PCook&&r.Read(),S.Log("Run()Persist.PID:"+r.Data.PID),!C.Enabled)return S.Log("Run - Tracking not enabled (set by script)"),v.CB_Initilize();if(!D.Data.IsActiveTracking)return S.Log("Run - Tracking not enabled (set by server)"),v.CB_Initilize();v.SendToServer("/PageHit/",D.URL()),S.Log("Run()Page Hit Registered")}catch(t){S.Log("EXCEPTION()<b style='color:red;'>EXCEPTION<b>:<br>"+t.stack)}}(t)},Track:C,Tools:function(t,e){return this.ScriptID=t,tool=new i(t,e),l.push(tool),tool;function i(t,e){var i=null,o=null,n=null,a=[];this.ScriptID=t,this.MyElementID=e,this.OpenNewTabOnWidth=320,this.Button=new r(this),this.Widget=new s(this),this.ExcludeUrl=function(t){a.push(t)},this.IsExcludeUrl=function(){var t,e=document.location.href.toLowerCase();for(t in a)if(-1!=e.indexOf(a[t]))return S.Log("Tools.Tool.IsExcludeUrl()Page is an excluded url"),!0;return!1},this.AddUrlData=function(t){o=t},this.GetUrlData=function(){return o},this.AddCustomData=function(t){t=(i=t).toLowerCase().indexOf("&");-1!=t&&(i=i.replace(/&/g,"%26")),-1!=(t=i.indexOf("?"))&&(i=i.replace(/\?/g,"%3F"))},this.GetCustomData=function(){return i},this.AddCustomDataGuid=function(t){n=t},this.GetCustomDataGuid=function(){return n}}function r(t){var s=t;this.MobileScreenWidth=480,this.FixedUrl=null,this.btnC4A=document.getElementById("C4A_btn"+s.ScriptID),this.btnZIndex=2147483598,this.DesktopCss="position:fixed; bottom:0; right:0; z-index:"+this.btnZIndex,this.MobileCss="position:fixed; bottom:8px; right:8px; z-index:"+this.btnZIndex;var l=document.location.href,l=m.IsUrlXSS(l)?"":(l=l.split("?")[0],encodeURIComponent(l));this.Render=function(){0==m.IsDeviceCompatibleForTools()||9999==s.ScriptID||s.IsExcludeUrl()||(S.Log("Button.Render()"),S.Log("Button.Render()Browser width:"+m.UIGetWindowHeightWidth().Width),S.Log("Button.Render()OpenNewTabOnWidth:"+s.OpenNewTabOnWidth),null!=s.MyElementID&&void 0!==s.MyElementID&&this.RenderForExistingElement(),this.btnC4A||null!=s.MyElementID&&void 0!==s.MyElementID||this.RenderNewC4AButton())},this.RenderForExistingElement=function(){S.Log("Button.Render()Attempt to configure existing button");var t,e,i,o,n=this.MobileScreenWidth>=m.UIGetWindowHeightWidth().Width,a=D.GetToolByScriptOrExperience(s.ScriptID,s.ExpGuid),r=document.getElementById(s.MyElementID);r&&(r.style.zIndex=this.btnZIndex,r.setAttribute("onmouseover","this.style.cursor='pointer';"),r.setAttribute("onmouseout","this.style.cursor='default';"),r.onkeypress=function(t){13==t.keyCode&&this.click()},1==a.ImpType||s.OpenNewTabOnWidth>=m.UIGetWindowHeightWidth().Width||m.IsDeviceiPhone()?(t=0!=a.ToolType?a.ToolType:1,o=v.DomainTI+"/"+v.GetPageName(t)+"?AccGUID="+p+"&ScriptID="+s.ScriptID+"&ExpGUID="+a.ExpGuid+"&ToolType="+t+"&SID="+D.Data.SID,e=s.GetUrlData(),i=s.GetCustomDataGuid(),null!=e&&(o+="&"+e),o+="&PushD="+s.GetCustomData(),null!=i&&(o+="&CustomDataGuid="+i),r.setAttribute("c4a_Url",o),r.setAttribute("c4a_Name",t),r.onclick=function(){var t=this.getAttribute("c4a_Url"),e=this.getAttribute("c4a_Name"),i="";isNaN(a.Height)||(i+="height="+a.Height+","),isNaN(a.Width)||(i+="width="+a.Width);i="menubar=no,location=no,resizable=no,scrollbars=auto,status=no,"+i;return window.open(t,e,i),!1}):r.onclick=function(){s.Widget.Open()},o=null!=this.FixedUrl?this.FixedUrl:v.DomainSI+"/Button?strAccGUID="+p+"&strScriptID="+s.ScriptID+"&strIsMobile="+n+"&strPageUrl="+l,"IMG"==r.nodeName?r.src=o:(r.style.backgroundSize="contain",r.style.backgroundImage="url('"+o+"')"))},this.RenderNewC4AButton=function(){S.Log("Button.Render()Attempt to create our own button");var t=this.MobileScreenWidth>=m.UIGetWindowHeightWidth().Width,a=D.GetToolByScriptOrExperience(s.ScriptID,s.ExpGuid);this.btnC4A=document.createElement("img"),this.btnC4A.id="C4A_btn"+s.ScriptID,this.btnC4A.style.zIndex=this.btnZIndex,this.btnC4A.style.cssText=1==t?this.MobileCss:this.DesktopCss,this.btnC4A.setAttribute("onmouseover","this.style.cursor='pointer';"),this.btnC4A.setAttribute("onmouseout","this.style.cursor='default';"),this.btnC4A.setAttribute("alt","Live Chat Software Click4Assistance;"),this.btnC4A.setAttribute("tabindex","0"),this.btnC4A.onkeypress=function(t){13==t.keyCode&&this.click()},1==a.ImpType||s.OpenNewTabOnWidth>=m.UIGetWindowHeightWidth().Width||m.IsDeviceiPhone()?this.btnC4A.onclick=function(){var t=0!=a.ToolType?a.ToolType:1,e=v.DomainTI+"/"+v.GetPageName(t)+"?AccGUID="+p+"&ScriptID="+s.ScriptID+"&ExpGUID="+a.ExpGuid+"&ToolType="+t+"&SID="+D.Data.SID,i=s.GetUrlData(),o=s.GetCustomDataGuid();null!=i&&(e+="&"+i),e+="&PushD="+s.GetCustomData(),null!=o&&(e+="&CustomDataGuid="+o);try{var n=p.toUpperCase();null==p||"01DCDED4-D168-4D22-AB4B-D073501B8353"!=n&&"05E4E0A8-61D3-41CC-8454-3B2425F643C8"!=n&&"3A7ADAFD-9926-4503-BB98-E3BB2B04DC7B"!=n||(n=document.location.href,m.IsUrlXSS(n)?e+="&OpenedFromFullPageUrl=XSS":e+="&OpenedFromFullPageUrl="+encodeURIComponent(n))}catch(t){S.Log("Button.Render() - OpenedFromFullPageUrl _iFra:"+_iFra.id+" - url:"+e)}/^((?!chrome|android|crios|fxios).)*safari/i.test(navigator.userAgent)?window.open(e,t,"menubar=no,location=no,resizable=no,scrollbars=auto,status=no"):(o="menubar=no,location=no,resizable=no,scrollbars=auto,status=no,height="+a.Height+",width="+a.Width,window.open(e,t,o))}:this.btnC4A.onclick=function(){var t,e,i,o;C4A.iOSFix&&(t=-1!=navigator.userAgent.indexOf("iPhone"),e=-1!=navigator.userAgent.indexOf("iPod"),i=-1!=navigator.userAgent.indexOf("iPad"),(t||e||i)&&(S.Log("SI - iOS device detected"),0<document.querySelectorAll('meta[name="viewport"]').length||(S.Log("SI - Meta viewport added for iOS device"),(o=document.createElement("meta")).id="viewport",o.name="viewport",o.content="initial-scale = 1.0,maximum-scale = 1.0",document.getElementsByTagName("head")[0].appendChild(o)),i="html,body { -webkit-overflow-scrolling : touch !important; overflow: auto !important; height: 100% !important;}",(o=document.createElement("style")).stylesheet?o.stylesheet.csstext=i:o.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(o),S.Log("SI - css added for iOS device"))),s.Widget.Open()};var e=null!=this.FixedUrl?this.FixedUrl:v.DomainSI+"/Button?strAccGUID="+p+"&strScriptID="+s.ScriptID+"&strIsMobile="+t+"&strPageUrl="+l;this.btnC4A.src=e,document.body.insertBefore(this.btnC4A,null),S.Log("Button.Render()Added to body: "+this.btnC4A.id+"... CSS: "+this.btnC4A.style.cssText+", isMobile:"+t+" , src:+"+this.btnC4A.src)}}function s(e){var a=e,r=350,s=350,l=document.getElementById("iFraC4AW"+a.ScriptID);this.Css="position:fixed; right:0; bottom:0; z-index:2147483599; border:0;",this.AlignRight=!0,this._animat=null,this.Animation=function(){return null==this._animat&&(this._animat=new C4A.Animation),this._animat},this.Render=function(){var t;S.Log("Widget.Render()"),S.Log("Widget.Render()Css:"+this.Css),l||(t=D.GetToolByScriptOrExperience(e.ScriptID,e.ExpGuid),r=t.Width,s=t.Height,(l=document.createElement("iframe")).id="iFraC4AW"+a.ScriptID,l.title="Click4Assistance Live Chat",l.style.cssText=this.Css+";width:"+r+"px; height:"+s+"px",l.style.display="none",l.allow="camera; microphone",l.style.marginheight="0px",l.style.marginWidth="0px",l.style.borderWidth="0px",l.allowtransparency=!0,l.setAttribute("AlignRight",this.AlignRight),document.body.insertBefore(l,null))},this.Open=function(t,e){if(S.Log("Widget.Open()"),!a.IsExcludeUrl()){null!=a.Button.btnC4A&&(a.Button.btnC4A.style.display="none"),void 0===e&&(e=!1),S.Log("Widget.Open() - IsCallback:"+e),S.Log("Widget.Open() - ScriptID:"+a.ScriptID+" - ExpGuid:"+a.ExpGuid);var i=D.GetToolByScriptOrExperience(a.ScriptID,a.ExpGuid);if(0==e&&(null==i.ExpGuid||0==i.ExpGuid.length))return D.Write(),void v.SendToServer("/ToolData/",D.URL()+"&ScriptID="+i.ScriptID);i.Displayed=!0,D.Write();var o,n=v.DomainTI+"/"+v.GetPageName(i.ToolType)+"?AccGUID="+p+"&ScriptID="+i.ScriptID+"&ExpGUID="+i.ExpGuid+"&ToolType="+i.ToolType+"&ChatGUID="+i.ChatGuid+"&ChatAccountGUID="+i.ChatAccountGuid+"&SID="+D.Data.SID;void 0!==t&&(n+="&ThisFormType="+t),null!=a.GetUrlData()&&(n+="&"+a.GetUrlData()),n+="&PushD="+a.GetCustomData(),null!=a.GetCustomDataGuid()&&(n+="&CustomDataGuid="+a.GetCustomDataGuid());try{null==p||"01DCDED4-D168-4D22-AB4B-D073501B8353"!=p.toUpperCase()&&"05E4E0A8-61D3-41CC-8454-3B2425F643C8"!=p.toUpperCase()&&"3A7ADAFD-9926-4503-BB98-E3BB2B04DC7B"!=p.toUpperCase()||(o=document.location.href,m.IsUrlXSS(o)?n+="&OpenedFromFullPageUrl=XSS":n+="&OpenedFromFullPageUrl="+encodeURIComponent(o))}catch(t){S.Log("Widget.Open() - OpenedFromFullPageUrl _iFra:"+l.id+" - src:"+n)}S.Log("Widget.Open()_iFra:"+l.id+" - src:"+n),l.setAttribute("RealSrc",n),l.src=l.getAttribute("RealSrc")+"&Rnd="+Math.random();e=this.Animation(),t="";null!=a.Button.btnC4A&&(t=a.Button.btnC4A.style.top),e.Initilize(l,s,r,t,!1),e.ScriptId=i.ScriptID,1==i.ToolType||2==i.ToolType?i.ChatGuid?(S.Log("Widget.Open() - Animate(4)"),e.Animate(4)):v.SendToServer("/AnimatePreDialogWindow/","ExpGuid="+i.ExpGuid+"&ScriptID="+i.ScriptID+"&Top="+t):(S.Log("Widget.Open() - Animate(5)"),e.Animate(5)),c.push(e)}},this.Close=function(t){S.Log("Widget.Close()"),null!=a.Button.btnC4A&&(a.Button.btnC4A.style.display="block"),S.Log("Widget.Close() No of Animations Before :"+c.length);for(var e=999,i=0;i<c.length;i++){S.Log("Widget.Close() Looping - Idx:"+i);var o=c[i];o.ScriptId==a.ScriptID&&(e=i,S.Log("Widget.Close() animat.ScriptId:"+o.ScriptId),o.Close(a.ScriptID,t))}999!=e&&c.splice(e,1),S.Log("Widget.Close() No of Animations After:"+c.length),D.GetToolByScriptOrExperience(a.ScriptID,a.ExpGuid).Displayed=!1,D.Write()}}},Conversion:n,Prospect:s,Comms:v,Proactive:I,ClearSessionData:ClearSessionData,PersistData:PersistData,SessionData:SessionData,Animation:function(){var l=null,c=0,d=0,u=0,h=!1,p=!1,C=null;function n(){l.style.top=0,l.style.left=0,l.style.position="absolute",l.style.height=c,l.style.width=d,l.style.bottom=0,l.style.right=0,l.style.display="none",h=!1;var t=void 0!==l.style.opacity,e=!t&&void 0!==l.style.filter;t&&(l.style.opacity=parseFloat(1)),e&&(l.style.filter="alpha(opacity=100)"),l.style.MozOpacity=parseFloat(1)}function g(t,e,i,o){return i*((t=t/o-1)*t*t*t*t+1)+e}this.ScriptId=0,this.Initilize=function(t,e,i,o,n){u=o,c=e,d=i,(l=t).style.height=c+"px",l.style.width=d+"px",h=!1,p=n},this.Close=function(t,e){var i,o;t&&(l=document.getElementById("iFraC4AW"+t)),l&&(null!=C&&clearInterval(C),i=c,o=(new Date).getTime(),C=setInterval(function(){var t=(new Date).getTime()-o,e=g(t,i,0-i,1e3);l.style.height=e+"px",1e3<=t&&(n(),clearInterval(C))},1e3/60),this.GreyOutHide(),S.Log("Animation.Close() setting blank src for iframe id: "+l.id+" original src:"+l.src),e||(l.src="about:blank"))},this.GreyOutHide=function(){var t=document.getElementById("C4A_divGreyOut");t&&document.body.removeChild(t),n()},this.GreyOutShow=function(){var t=document.body,e=document.documentElement,i=Math.max(t.scrollWidth,t.offsetWidth,e.clientWidth,e.scrollWidth,e.offsetWidth),t=Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight),e=document.getElementById("C4A_divGreyOut");e||((e=document.createElement("div")).id="C4A_divGreyOut",e.setAttribute("style","position:absolute; top:0; left:0;width:"+i+"px; height:"+t+'px; z-index:2147483600; background-color: rgba(0, 0, 0, 0.8); -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";background-color: #000000\\0/;  '),document.body.appendChild(e),e.addEventListener?e.addEventListener("click",C4A.Animation.GreyOutHide,!1):e.attachEvent?e.attachEvent("onclick",C4A.Animation.GreyOutHide):e.onclick=C4A.Animation.GreyOutHide)},this.Animate=function(t){var e,i,o,n,a,r,s;l&&(e=function(t,e,i){var o=0,n=0,a=0,r=0,s=m.UIGetWindowHeightWidth(),l=m.UIGetScrollPosition();1==t&&(o=s.Height/2-e/2+l.TopOffset,n=s.Width/2-i/2+l.LeftOffset,a=o,r=n);2==t&&(o=s.Height/2-e/2+l.TopOffset,n=0-i+l.LeftOffset,a=o,r=s.Width/2-i/2+l.LeftOffset);3==t&&(o=0-e+l.TopOffset,n=s.Width-i+l.LeftOffset,a=s.Height-e+l.TopOffset,r=n);4==t&&(o=s.Height+e+l.TopOffset,n=s.Width-i+l.LeftOffset,a=s.Height-e+l.TopOffset,r=n);l=new Array;return l.StartTop=o,l.StartLeft=n,l.StopTop=a,l.StopLeft=r,l}(t,c,d),n=o=i=0,a=(new Date).getTime(),h||(p?this.GreyOutShow():this.GreyOutHide(),h=!0,1==t&&(l.style.top=e.StopTop+"px",l.style.left=e.StopLeft+"px",l.style.height=c+"px",l.style.width=d+"px",l.style.position="absolute",l.style.display="none",i=e.StartLeft,o=e.StopLeft,r=0,s=setInterval(function(){var t,e;h?(e=!(t=void 0!==l.style.opacity)&&void 0!==l.style.filter,t&&(l.style.opacity=parseFloat(r/100)),e&&(l.style.filter="alpha(opacity="+r+")"),l.style.MozOpacity=parseFloat(r/100),r++,l.style.display="block",100<=r&&(h=!1,clearInterval(s))):clearInterval(s)},1e3/60)),2==t&&(l.style.display="block",l.style.top=e.StartTop+"px",l.style.left=e.StartLeft+"px",l.style.height=c+"px",l.style.width=d+"px",l.style.position="absolute",l.style.bottom="",l.style.right="",i=e.StartLeft,o=e.StopLeft,n=2e3,s=setInterval(function(){var t,e;h?(e=g(t=(new Date).getTime()-a,i,o-i,n),l.style.left=e+"px",(n<=t||!h)&&(h=!1,clearInterval(s))):clearInterval(s)},1e3/60)),3==t&&(l.style.display="block",l.style.top=e.StartTop+"px",l.style.left="",l.style.height=c+"px",l.style.width=d+"px",l.style.bottom="0",l.style.right="0",l.style.position="absolute",i=e.StartTop,o=e.StopTop,n=2e3,s=setInterval(function(){var t,e;h?(e=g(t=(new Date).getTime()-a,i,o-i,n),l.style.top=e+"px",(n<=t||!h)&&(l.style.bottom="0",l.style.right="0",l.style.position="fixed",l.style.top="",h=!1,clearInterval(s))):clearInterval(s)},1e3/60)),4==t&&(l.style.display="block",l.style.position="fixed",l.style.height="0",l.style.width=d+"px","true"==l.getAttribute("AlignRight")?(l.style.left="",l.style.right="0"):(l.style.left="0",l.style.right=""),l.style.bottom="0",l.style.top="",i=0,o=c,n=2e3,null!=C&&clearInterval(C),C=setInterval(function(){var t,e;h?(e=g(t=(new Date).getTime()-a,i,o-i,n),l.style.height=e+"px",(n<=t||!h)&&(l.style.display="block",h=!1,clearInterval(C))):clearInterval(C)},1e3/60)),5==t&&(l.style.display="block",l.style.top=u,l.style.left="0px",l.style.height=c+"px",l.style.width="0px",l.style.position="fixed",l.style.bottom="",l.style.right="",i=0,o=d,n=1e3,null!=C&&clearInterval(C),C=setInterval(function(){var t,e;h?(S.Log("Animation:Animate:_iFra.id"+l.id),e=g(t=(new Date).getTime()-a,i,o-i,n),l.style.width=e+"px",(n<=t||!h)&&(h=!1,clearInterval(C))):clearInterval(C)},1e3/60))))}},Debug:S,iOSFix:iOSFix}}();InitialiseC4A();